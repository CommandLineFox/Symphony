{"version":3,"file":"CommandHandler.js","sourceRoot":"","sources":["CommandHandler.ts"],"names":[],"mappings":";;;;;AACA,iFAAyD;AAEzD,kEAA0C;AAE1C,MAAqB,cAAc;IAI/B,YAAa,MAAmB;QAC5B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,QAAQ,GAAG,CAAE,KAAK,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,MAAM,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,GAAG,CAAE,CAAC;QAC9E,MAAM,CAAC,EAAE,CAAC,SAAS,EAAE,CAAC,OAAO,EAAE,EAAE;YAC7B,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;QAChC,CAAC,CAAC,CAAC;IACP,CAAC;IAEO,aAAa,CAAC,OAAgB;QAClC,MAAM,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;QAChC,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QAEpD,IAAI,OAAO,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE;YAC5B,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;SACnE;aAEI,IAAI,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,EAAE;YAC3C,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,QAAS,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;SAC/E;aAEI,IAAI,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,EAAE;YAC3C,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,QAAS,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;SAC/E;IACL,CAAC;IAEO,YAAY,CAAC,OAAgB,EAAE,OAAe;QAClD,IAAI,OAAO,CAAC,MAAM,KAAK,CAAC,EAAE;YACtB,OAAO;SACV;QAED,MAAM,CAAC,OAAO,EAAE,IAAI,GAAG,EAAE,CAAC,GAAG,OAAO,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC;QAC3D,MAAM,OAAO,GAAG,yBAAe,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QAEpD,IAAI,OAAO,KAAK,SAAS,EAAE;YACvB,OAAO;SACV;QAED,OAAO,CAAC,OAAO,CAAC,IAAI,sBAAY,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC;IAClE,CAAC;IAEO,aAAa,CAAC,OAAgB,EAAE,OAAe;QACnD,IAAI,OAAO,CAAC,MAAM,KAAK,CAAC,EAAE;YACtB,OAAO,CAAC,KAAK,CAAC,uBAAuB,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAChF,OAAO;SACV;QACD,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;IACxC,CAAC;CACJ;AAnDD,iCAmDC","sourcesContent":["import EeveeClient from \"../EeveeClient\";\r\nimport CommandRegistry from \"../command/CommandRegistry\";\r\nimport { Message } from \"discord.js\";\r\nimport CommandEvent from \"./CommandEvent\";\r\n\r\nexport default class CommandHandler {\r\n    private readonly client: EeveeClient;\r\n    private mentions: string[];\r\n\r\n    constructor (client: EeveeClient) {\r\n        this.client = client;\r\n        this.mentions = [ `<@${this.client.user.id}>`, `<@!${this.client.user.id}>` ];\r\n        client.on(\"message\", (message) => {\r\n            this.handleMessage(message);\r\n        });\r\n    }\r\n\r\n    private handleMessage(message: Message) {\r\n        const content = message.content;\r\n        const prefix = this.client.getPrefix(message.guild);\r\n\r\n        if (content.startsWith(prefix)) {\r\n            this.handlePrefix(message, content.slice(prefix.length).trim());\r\n        }\r\n\r\n        else if (content.startsWith(this.mentions[0])) {\r\n            this.handleMention(message, content.slice(this.mentions![0].length).trim());\r\n        }\r\n\r\n        else if (content.startsWith(this.mentions[1])) {\r\n            this.handleMention(message, content.slice(this.mentions![1].length).trim());\r\n        }\r\n    }\r\n\r\n    private handlePrefix(message: Message, content: string) {\r\n        if (content.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const [trigger, args = \"\"] = content.split(/\\s+([\\s\\S]+)/);\r\n        const command = CommandRegistry.getCommand(trigger);\r\n\r\n        if (command === undefined) {\r\n            return;\r\n        }\r\n\r\n        command.execute(new CommandEvent(message, this.client, args));\r\n    }\r\n\r\n    private handleMention(message: Message, content: string) {\r\n        if (content.length === 0) {\r\n            message.reply(`My prefix here is \\`${this.client.getPrefix(message.guild)}>\\``);\r\n            return;\r\n        }\r\n        this.handlePrefix(message, content);\r\n    }\r\n}"]}